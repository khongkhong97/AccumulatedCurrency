let base_config={currencyFrom:"CHF",currencyTo:"EUR",notifications:1,portfolio:1,refreshDelay:30,colorChange:1,badgePortfolioConversion:0,roundBadge:0,badgeTextAnimate:0,soundNotification:1,soundSample:"mute",targetPrice:{EUR:0,CHF:0},panicPrice:{EUR:0,CHF:0},portfolioValue:{EUR:0,CHF:0},curs:{0:"EUR",1:"CHF"},chartPeriod:"1d"};window.browser=window.msBrowser||window.browser||window.chrome;let isIE=!!document.documentMode,isEdge=!isIE&&!!window.StyleMedia,isChrome=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);function analytics(){let e=[];e.push(["_setAccount","UA-XXXXXXXXX-1"]),e.push(["_trackPageview"]),function(){let e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://ssl.google-analytics.com/ga.js";let o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(e,o)}()}function initializeConfig(e){void 0===localStorage.trulyReallyTrulyBeenHereBefore&&(localStorage.setItem("currencyFrom",e.currencyFrom),localStorage.setItem("currencyTo",e.currencyTo),localStorage.setItem("notifications",e.notifications),localStorage.setItem("portfolio",e.portfolio),localStorage.setItem("refreshDelay",1e3*e.refreshDelay),localStorage.setItem("colorChange",e.colorChange),localStorage.setItem("badgePortfolioConversion",e.badgePortfolioConversion),localStorage.setItem("roundBadge",e.roundBadge),localStorage.setItem("badgeTextAnimate",e.badgeTextAnimate),localStorage.setItem("soundNotification",e.soundNotification),localStorage.setItem("soundSample",e.soundSample),localStorage.setItem("targetPrice",JSON.stringify(e.targetPrice)),localStorage.setItem("panicPrice",JSON.stringify(e.panicPrice)),localStorage.setItem("portfolioValue",JSON.stringify(e.portfolioValue)),localStorage.setItem("curs",JSON.stringify(e.curs)),localStorage.setItem("chartPeriod",e.chartPeriod),localStorage.setItem("lastPrice",0),localStorage.setItem("trulyReallyTrulyBeenHereBefore","yes")),setInterval(updateTicker,localStorage.refreshDelay)}function getJSON(e,o){let t=new XMLHttpRequest;t.open("GET",e,!0),t.onload=function(){if(t.status>=200&&t.status<400){let e=JSON.parse(t.responseText);o(e)}},t.onerror=function(e){console.log("Revolut does not respond.")},t.send()}function updateTicker(){getJSON("https://www.revolut.com/api/quote/internal?symbol="+localStorage.currencyFrom+localStorage.currencyTo,function(e){let o=e[0].rate,t=o.toString();if(setBadgeColor("#00ACE2"),parseInt(localStorage.colorChange)&&(parseFloat(o)>localStorage.lastPrice?(setBadgeColor("#2B8F28"),setTimeout(function(){setBadgeColor("#00ACE2")},4e3)):parseFloat(o)<localStorage.lastPrice&&(setBadgeColor("#FF4143"),setTimeout(function(){setBadgeColor("#00ACE2")},4e3))),parseInt(localStorage.badgePortfolioConversion)){t=(JSON.parse(localStorage.portfolioValue)[localStorage.currencyFrom]*o).toString()}if(parseInt(localStorage.roundBadge)){let e=1>parseFloat(t)?1:0,o=5;e+o<t.length&&(t=parseFloat(t).toFixed(3+e)),e+o<t.length&&(t=parseFloat(t).toFixed(2+e)),e+o<t.length&&(t=parseFloat(t).toFixed(1+e)),e+o<t.length&&(t=parseFloat(t).toFixed(e)),t=t.toString().substring(e,e+o)}if(isEdge&&(t=t.substring(0,4)),browser.browserAction.setBadgeText({text:t}),localStorage.lastPrice=o,parseInt(localStorage.badgeTextAnimate)){new BadgeTextAnimator({text:t,interval:500,repeat:!1,size:6}).animate()}}),isChrome&&notificationManager()}function notificationManager(){if(console.log("notificationManager 1"),!parseInt(localStorage.notifications))return void console.log("notificationManager return");console.log("notificationManager 2");let e=Object.keys(JSON.parse(localStorage.curs)).length;console.log(e),console.log(localStorage.curs),console.log(localStorage);for(let o=0;o<e;o++);}function setBadgeColor(e){browser.browserAction.setBadgeBackgroundColor({color:e})}function createNotification(e,o){let t=null;browser.notifications.create("price",{type:"basic",title:localStorage.currencyTo+""+e+o,message:localStorage.currencyTo+browser.i18n.getMessage("notifTxt")+o,iconUrl:"/img/icon128.png",buttons:[{title:browser.i18n.getMessage("revolutBtn"),iconUrl:"/img/icon16.png"}]},function(e){t=e}),0!==parseFloat(localStorage.soundNotification)&&audioNotif()}function audioNotif(){new Audio("sounds/"+localStorage.soundSample+".mp3").play()}function startExtensionListeners(){browser.extension.onMessage.addListener(function(e,o,t){"resetTicker"==e.msg&&updateTicker()}),browser.notifications.onButtonClicked.addListener(function(e,o){browser.tabs.create({url:"https://www.revolut.com/money-transfer"})})}initializeConfig(base_config),analytics(),updateTicker(),startExtensionListeners();