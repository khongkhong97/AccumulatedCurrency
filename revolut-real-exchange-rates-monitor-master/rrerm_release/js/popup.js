function startListeners(){document.querySelector('select[name="chartPeriod"]').onchange=function(e){this.blur(),updateChartPeriod(e)},document.querySelector('th[name="ico"').onclick=rollCurrency;["targetPrice","panicPrice","portfolioValue"].forEach(function(e){document.querySelector('input[name="'+e+'"]').onkeyup=updateLocalStorageFromInputValue}),document.getElementById("settingsBtn").onclick=function(){browser.tabs.create({url:"views/options.html"})}}function translate(){["strSpotrate","strTargetPrice","strPanicPrice","str1d","str5d","str1mo","str3mo","str6mo","str1y","str2y","str5y","strYtd","strMax","revolutBtn","settingsBtn","donateBtn"].forEach(function(e){null!=document.getElementById(e)?document.getElementById(e).innerHTML=browser.i18n.getMessage(e):console.log(e+" not found.")})}function analytics(){let e=[];e.push(["_setAccount","UA-XXXXXXXXX-1"]),e.push(["_trackPageview"]),function(){let e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://ssl.google-analytics.com/ga.js";let t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(),document.getElementById("revolutBtn").onclick=function(){e.push(["_trackEvent","revolutButton","clicked"])}.bind(this),document.getElementById("settingsBtn").onclick=function(){browser.tabs.create({url:"views/options.html"}),e.push(["_trackEvent","settingsButton","clicked"])}.bind(this),document.getElementById("donateBtn").onclick=function(){browser.tabs.create({url:"views/donate.html"}),e.push(["_trackEvent","donateButton","clicked"])}.bind(this)}function getChartValues(){let e=localStorage.chartPeriod,t={"1d":"15m","5d":"30m","1mo":"1h","3mo":"1d","6mo":"5d","1y":"5d","2y":"1wk","5y":"1wk",ytd:"1wk",max:"1wk"}[e],o=[];getJSON("https://www.revolut.com/api/history/"+localStorage.currencyFrom+localStorage.currencyTo+"=X?range="+e+"&interval="+t,function(r,n){if(r.chart.error||void 0===r.chart.result[0].timestamp)return console.log("https://www.revolut.com/api/history/"+localStorage.currencyFrom+localStorage.currencyTo+"=X?range="+e+"&interval="+t),console.log("No chart data for this currency"),void(document.getElementById("chart").style.display="none");let c=r.chart.result[0].timestamp.length,l=r.chart.result[0].indicators.quote[0];for(let e=0;e<c;e++){let t=l.close[e],r=l.open[e];t&&r&&o.push({x:e*(200/c),y:(t+r)/2})}buildChart(o);let i=c-1,a=(l.close[0]+l.open[0])/2,u=100*((l.close[i]+l.open[i])/2)/a-100,s=u>0?"+":"",d=u>0?"#2B8F28":"#FF4143";document.querySelector("#changeValue").innerHTML=s+u.toFixed(2)+"%",document.querySelector("#changeValue").style.color=d})}function buildChart(e){let t=document.getElementById("chartCanvas");"undefined"!=typeof priceChart&&priceChart.destroy(),priceChart=new Chart(t,{type:"line",data:{datasets:[{label:"price",fill:!1,data:e,pointRadius:0,borderWidth:2,borderColor:"#2B71B1",lineTension:.1}]},options:{legend:{display:!1},tooltips:{mode:"index",intersect:!1,callbacks:{title:function(){return""},label:function(e){return String(e.yLabel).substring(0,7)}}},scales:{xAxes:[{display:!1,type:"linear",position:"bottom"}]},hover:{}}},{lineAtIndex:2})}function togglePortfolio(e){switch(e){case"0":document.getElementById("portfolio").style.visibility="hidden",document.getElementById("portfolio").style.height="0px",document.getElementById("portfolio").style.marginTop="0px",document.getElementById("portfolio").style.padding="0px",document.getElementById("portfolio").style.display="none";break;case"1":document.getElementById("portfolio").style.visibility="visible",document.getElementById("portfolio").style.height="auto",document.getElementById("portfolio").style.marginTop="5px";break;default:console.log("error",e)}}function toggleNotifications(e){switch(e){case"0":document.getElementById("limitOptions").style.visibility="hidden",document.getElementById("limitOptions").style.height="0px",document.getElementById("limitOptions").style.marginTop="0px",document.getElementById("limitOptions").style.padding="0px",document.getElementById("limitOptions").style.display="none";break;case"1":document.getElementById("limitOptions").style.visibility="visible",document.getElementById("limitOptions").style.height="auto",document.getElementById("limitOptions").style.marginTop="5px";break;default:console.log("error",e)}}function loadLocalStorageIntoInputValue(){if(parseInt(localStorage.notifications)){let e=JSON.parse(localStorage.targetPrice);document.querySelector('input[name="targetPrice"]').value=e[localStorage.currencyFrom];let t=JSON.parse(localStorage.panicPrice);document.querySelector('input[name="panicPrice"]').value=t[localStorage.currencyFrom]}if(parseInt(localStorage.portfolio)){document.getElementById("tabletitle").innerHTML=localStorage.currencyFrom+" to "+localStorage.currencyTo;let e=JSON.parse(localStorage.portfolioValue);document.querySelector('input[name="portfolioValue"]').value=e[localStorage.currencyFrom],document.querySelector('select[name="chartPeriod"]').value=localStorage.chartPeriod}}function updatePrices(){let e,t,o;getJSON("https://www.revolut.com/api/quote/internal?symbol="+localStorage.currencyFrom+localStorage.currencyTo,function(r){document.getElementById("priceNumbers").style.visibility="visible",document.getElementById("error").style.visibility="hidden",e=r[0].rate.toString(),localStorage.lastSpot=r[0].rate,t=r[0].rate,(o=document.getElementById("priceRate")).innerHTML=e.toString(),updatePortfolio()})}function updatePortfolio(){let e=JSON.parse(localStorage.portfolioValue)[localStorage.currencyFrom];document.getElementById("portfolioConversion").innerHTML=(e*localStorage.lastSpot).toFixed(2)+" "+localStorage.currencyTo}function updateTargetPrice(e){var t=JSON.parse(localStorage.targetPrice);t[localStorage.currencyFrom]=e.target.value,localStorage.targetPrice=JSON.stringify(t)}function updatePanicPrice(e){var t=JSON.parse(localStorage.panicPrice);t[localStorage.currencyFrom]=e.target.value,localStorage.panicPrice=JSON.stringify(t)}function changeCurrencyIcon(){"GBP"===localStorage.currencyTo?(document.querySelector('img[name="currIco"]').src="/img/eth16.png",document.querySelector('img[name="currIco2"]').src="/img/eth16.png"):"EUR"===localStorage.currencyTo?(document.querySelector('img[name="currIco"]').src="/img/btc16.png",document.querySelector('img[name="currIco2"]').src="/img/btc16.png"):"USD"===localStorage.currencyTo?(document.querySelector('img[name="currIco"]').src="/img/ltc16.png",document.querySelector('img[name="currIco2"]').src="/img/ltc16.png"):"CHF"===localStorage.currencyTo?(document.querySelector('img[name="currIco"]').src="/img/bch16.png",document.querySelector('img[name="currIco2"]').src="/img/bch16.png"):"PLN"===localStorage.currencyTo&&(document.querySelector('img[name="currIco"]').src="/img/btc16.png",document.querySelector('img[name="currIco2"]').src="/img/btc16.png")}function rollCurrency(){let e=["AED","AUD","BCH","BTC","CAD","CHF","CZK","DKK","ETH","EUR","GBP","HKD","HUF","ILS","JPY","LTC","MAD","NOK","NZD","PLN","QAR","RON","SEK","SGD","THB","TRY","USD","XRP","ZAR"],t=e.indexOf(localStorage.currencyTo)+1;t>e.length-1&&(t=0),localStorage.currencyTo=e[t],changeCurrencyIcon(),updatePrices(),getChartValues(),loadLocalStorageIntoInputValue()}function getJSON(e,t){let o=new XMLHttpRequest;o.open("GET",e,!0),o.onload=function(){if(o.status>=200&&o.status<400){let e=JSON.parse(o.responseText);t(e,o)}},o.onerror=function(){document.getElementById("priceNumbers").style.visibility="hidden",document.getElementById("error").style.visibility="visible"},o.send()}function updateLocalStorageFromInputValue(e){e||(e=window.event);let t=JSON.parse(localStorage[e.target.id]);t[localStorage.currencyFrom]=e.target.value,localStorage[e.target.id]=JSON.stringify(t),"portfolioValue"===e.target.id&&updatePortfolio(e),"targetPrice"===e.target.id&&updateTargetPrice(e),"panicPrice"===e.target.id&&updatePanicPrice(e)}function hideUselessFields(){document.querySelector('div[id="limitOptions"]').style.visibility="hidden",document.querySelector('div[id="limitOptions"]').style.height="0px"}function updateChartPeriod(e){localStorage.chartPeriod=e.target.value,getChartValues()}document.addEventListener("DOMContentLoaded",function(){/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);let e=!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,t="undefined"!=typeof InstallTrigger,o=!!document.documentMode,r=!o&&!!window.StyleMedia,n=localStorage.portfolio,c=localStorage.notifications;startListeners(),translate(),analytics(),getChartValues(),togglePortfolio(n.toString()),toggleNotifications(c.toString()),loadLocalStorageIntoInputValue(),updatePrices(),updatePortfolio(),changeCurrencyIcon(),(e||t||o||r)&&hideUselessFields()}),window.browser=window.msBrowser||window.browser||window.chrome;